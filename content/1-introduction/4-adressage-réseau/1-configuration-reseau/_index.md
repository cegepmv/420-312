+++
pre = '<b>1. </b>'
title = 'Configuration réseau'
draft = false
weight = "140"
+++

## Interface réseau
Une interface réseau est un point de connexion matériel (comme une carte réseau physique) ou logiciel qui permet à un appareil de communiquer avec un réseau, qu'il soit privé ou public, en envoyant et recevant des données. Cette interface possède obligatoirement une adresse MAC et optionnellement (si elle est configurée) une ou plusieurs adresses IP.

Il est aussi possible de donner d'autres informations à une interface réseau, notamment : 

+ **Passerelle par défaut :** La passerelle est la porte de sortie d’un réseau : lorsque vous ouvrez une connexion sur un serveur qui se trouve sur internet (par exemple www.google.com), la communication entre votre PC et ce serveur passe par cette passerelle.
+ **Adresse(s) du/des serveur(s) DNS :** Un serveur DNS permet (entre autre) à un hôte du réseau de récupérer l'adresse IP associée à un nom de domaine. Nous verrons plus tard dans le cours quelles sont les spécificités du protocole et même comment configurer un serveur DNS !

## Fichiers de configuration

### `/etc/resolv.conf`
+ Le fichier `/etc/resolv.conf` permet de configurer les serveurs DNS qui seront utilisés par votre machine.
+ Les instructions facultatives `domain` et `search` indiquent à quel domaine appartient votre machine et dans quel domaine doivent être cherché les noms qui ne sont pas des FQDN.
+ Les instructions `nameserver` indiquent les serveurs DNS que vous allez interroger et l’ordre dans lequel vous les interrogez.
+ Il faut un serveur par ligne.

```bash
# Generated by NetworkManager
search localdomain linux.local
nameserver 192.168.230.2
nameserver 8.8.8.8
```

### `/etc/hosts`
+ Le fichier `/etc/hosts` permet d’associer un nom de machine à une adresse IP soit parce qu’elle n’existe pas dans le serveur DNS (réseau privé, machine de test…) ou pour préférer utiliser une adresse IP particulière plutôt que celle du DNS.
+ Ce fichier est utilisé en priorité par rapport aux serveurs DNS.
+ Sa syntaxe est la suivante:
```bash
<adresse ip> <nom>
```
+ Exemple :
```bash
192.168.230.122		www.google.com
```
Ma machine ira au `192.168.230.122` à chaque fois que je voudrai consulter www.google.com.

Grâce à ce fichier, il est donc possible de configurer la résolution de noms dans un petit réseau ou dans un laboratoire. De cette façon, toutes les machines pourront être jointes par leur nom plutôt que par leur adresse IP.

## Commandes de base

### `nmcli`

La commande `nmcli` permet de gérer les interfaces réseau d'une machine.

Pour lister les connections réseau :
```bash
nmcli dev
```
Pour afficher la configuration ip :
```bash
ip a
nmcli con show ens160
```

Pour configurer une adresse IP statique (au lieu de la recevoir dynamiquement) :
```bash
nmcli con mod ens160 ipv4.address 192.168.230.10/24
nmcli con mod ens160 ipv4.gateway 192.168.230.2
nmcli con mod ens160 ipv4.dns 8.8.8.8,8.8.4.4
nmcli con mod ens160 ipv4.method manual
nmcli con down ens160
nmcli con up ens160
```

Pour revenir en mode dynamique :
```bash
nmcli con mod ens160 ipv4.method auto
nmcli con mod ens160 ipv4.dns ""
nmcli con mod ens160 ipv4.gateway "" ipv4.addresses ""
nmcli con down ens160
nmcli con up ens160
```
Après avoir ajouté une interface réseau, il faut la déclarer dans nmcli
```bash
nmcli con add con-name ens224 type ethernet ifname ens224
```
Elle se configure ensuite à l’aide de DHCP ou avec une IP fixe.

### `ifconfig`
`ifconfig` est un utilitaire de configuration du réseau.

+ Pour afficher la liste des interfaces et des informations de configuration comme l’adresse IP et le masque de sous-réseau.
```bash
ifconfig
```
+ Pour afficher la configuration d’une seule interface.
```bash
ifconfig <interface>
```
+ Pour désactiver/activer une interface réseau.
```bash
ifconfig <interface> down/up
```

### La commande `ip`

+ La commande `ip` remplace `ifconfig` qui devient obsolète.
+ `ip` est une commande beaucoup plus puissante que `ifconfig`.
+ Cette commande permet de modifier les paramètres IP des interfaces réseau mais uniquement de façon temporaire. Si l’ordinateur redémarre, les configurations seront perdues.
+ Pour rendre un configuration permanente, il faudra modifier les fichiers texte de configuration.
+ Cette commande reste néanmoins indispensable pour lire les configurations et tester de nouveaux paramètres.

+ Pour afficher la liste des interfaces:
```bash
ip address
```
ou
```bash
ip a
```

+ Pour une seule interface réseau:
```bash
ip a show <interface>
```
+ Pour redémarrer une interface pour que les nouveaux paramètres configurés dans les fichiers de configuration soient prises en comtpe:
```bash
ifdown <interface>
ifup <interface>
```
+ Il est possible de configurer plusieurs adresses IP sur une même interface à une condition: toutes les adresses IP doivent être dans le même sous-réseau.
+ Pour ajouter une adresse IP à une interface (ce ne sera pas permanent), il est possible d’ajouter plusieurs adresses IP à une interface:
```bash
ip addr add x.x.x.x /x dev <interface>
```
+ Exemple:
```bash
ip addr add 192.168.230.132/24 dev ens33
```
+ Pour la supprimer:
```bash
ip addr del x.x.x.x/x dev <interface>
```
+ Exemple:
```bash
ip addr del 192.168.230.132/24 dev ens33
```
+ Pour ajouter la passerelle par défaut:
```bash
ip route add default via x.x.x.x
```
+ Exemple:
```bash
ip route add default via 192.168.230.2
```
+ Pour afficher la liste des routes:
```bash
ip route
```
## Le service réseau
+ Ce service gère le réseau sous Linux.
+ Lorsque vous modifiez les fichiers de configuration du réseau, un redémarrage du réseau est nécessaire.

Pour arrêter le service:
```bash
nmcli networking off
```
+ Pour démarrer le service
```bash
nmcli networking on
```